(self.webpackChunkblog=self.webpackChunkblog||[]).push([[2943],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return u},kt:function(){return h}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=r.createContext({}),s=function(e){var n=r.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=s(e.components);return r.createElement(o.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),m=s(t),h=a,d=m["".concat(o,".").concat(h)]||m[h]||p[h]||l;return t?r.createElement(d,i(i({ref:n},u),{},{components:t})):r.createElement(d,i({ref:n},u))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,i=new Array(l);i[0]=m;var c={};for(var o in n)hasOwnProperty.call(n,o)&&(c[o]=n[o]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var s=2;s<l;s++)i[s]=t[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},1993:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return c},metadata:function(){return o},toc:function(){return s},default:function(){return p}});var r=t(2122),a=t(9756),l=(t(7294),t(3905)),i={},c=void 0,o={unversionedId:"Linux/\u4f7f\u7528acme.sh\u914d\u7f6eHTTPS",id:"Linux/\u4f7f\u7528acme.sh\u914d\u7f6eHTTPS",isDocsHomePage:!1,title:"\u4f7f\u7528acme.sh\u914d\u7f6eHTTPS",description:"Nginx \u670d\u52a1\u5668\u5b89\u88c5",source:"@site/document/docs/Linux/\u4f7f\u7528acme.sh\u914d\u7f6eHTTPS.md",sourceDirName:"Linux",slug:"/Linux/\u4f7f\u7528acme.sh\u914d\u7f6eHTTPS",permalink:"/docs/Linux/\u4f7f\u7528acme.sh\u914d\u7f6eHTTPS",version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"linux \u65b0\u5efa\u8d26\u6237",permalink:"/docs/Linux/linux \u65b0\u5efa\u8d26\u6237"},next:{title:"MacOS\u5728\u7ec8\u7aef\u4e2d\u4f7f\u7528\u4ee3\u7406",permalink:"/docs/MacOS/MacOS\u5728\u7ec8\u7aef\u4e2d\u4f7f\u7528\u4ee3\u7406"}},s=[{value:"Nginx \u670d\u52a1\u5668\u5b89\u88c5",id:"nginx-\u670d\u52a1\u5668\u5b89\u88c5",children:[]},{value:"Nginx \u914d\u7f6e",id:"nginx-\u914d\u7f6e",children:[]},{value:"acme.sh",id:"acmesh",children:[]},{value:"acme.sh \u4f1a\u5728\u8bc1\u4e66\u5230\u671f\u524d\u81ea\u52a8\u66f4\u65b0",id:"acmesh-\u4f1a\u5728\u8bc1\u4e66\u5230\u671f\u524d\u81ea\u52a8\u66f4\u65b0",children:[]},{value:"\u53c2\u8003",id:"\u53c2\u8003",children:[]}],u={toc:s};function p(e){var n=e.components,t=(0,a.Z)(e,["components"]);return(0,l.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"nginx-\u670d\u52a1\u5668\u5b89\u88c5"},"Nginx \u670d\u52a1\u5668\u5b89\u88c5"),(0,l.kt)("p",null,"\u5982\u679c\u5df2\u6709Nginx, \u8bf7\u8df3\u8fc7\u6b64\u6b65\u9aa4"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"yum install epel-release\nyum update\nyum install nginx\n")),(0,l.kt)("p",null,"\u4f7f\u7528"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u542f\u52a8 ",(0,l.kt)("inlineCode",{parentName:"li"},"systemctl start nginx")),(0,l.kt)("li",{parentName:"ul"},"\u505c\u6b62 ",(0,l.kt)("inlineCode",{parentName:"li"},"systemctl stop nginx")),(0,l.kt)("li",{parentName:"ul"},"\u91cd\u542f ",(0,l.kt)("inlineCode",{parentName:"li"},"systemctl restart nginx")),(0,l.kt)("li",{parentName:"ul"},"\u67e5\u770b\u8fd0\u884c\u72b6\u6001 ",(0,l.kt)("inlineCode",{parentName:"li"},"systemctl status nginx")),(0,l.kt)("li",{parentName:"ul"},"\u5f00\u673a\u542f\u52a8 ",(0,l.kt)("inlineCode",{parentName:"li"},"systemctl enable nginx"))),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"nginx-\u914d\u7f6e"},"Nginx \u914d\u7f6e"),(0,l.kt)("h4",{id:"\u4f7f\u7528-certbot-\u751f\u6210\u8bc1\u4e66"},"\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"h4"},"certbot")," \u751f\u6210\u8bc1\u4e66"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'\nyum install certbot\ncertbot certonly --webroot -w /usr/share/nginx/html/ -d xxxx.com\n\n\n#\u5982\u679c\u770b\u5230\u4e0b\u5217\u7684\u8f93\u51fa\uff0c\u5c31\u8bc1\u660e\u8bc1\u4e66\u5df2\u7ecf\u751f\u6210\u6210\u529f\u4e86:\n\n IMPORTANT NOTES:\n - Congratulations! Your certificate and chain have been saved at\n   /etc/letsencrypt/live/xxxx.com/fullchain.pem. Your cert\n   will expire on 20XX-09-23. To obtain a new or tweaked version of\n   this certificate in the future, simply run certbot again. To\n   non-interactively renew *all* of your certificates, run "certbot\n   renew"\n - If you like Certbot, please consider supporting our work by:\n\n   Donating to ISRG / Let\'s Encrypt:   https://letsencrypt.org/donate\n   Donating to EFF:                    https://eff.org/donate-le\n')),(0,l.kt)("hr",null),(0,l.kt)("h4",{id:"\u7f16\u8f91-nginx-\u914d\u7f6e\u6587\u4ef6"},"\u7f16\u8f91 nginx \u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"vi /etc/nginx/nginx.conf\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-conf"},'server {\n    listen       80;\n    server_name  xxx.com;\n    rewrite ^ https://$http_host$request_uri? permanent;    # http \u81ea\u52a8\u8df3\u8f6c\u5230 https\n    # root /home/www;\n    #return 301 https://$http_host$request_uri;\n}\n\nserver {\n    listen 443 ssl;\n\n    ssl_certificate /etc/letsencrypt/live/xxx.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/xxx.com/privkey.pem;\n    ssl_trusted_certificate /etc/letsencrypt/live/xxx.com/chain.pem;\n    keepalive_timeout   70;\n    server_name xxx.com;\n    # root /home/www;\n\n    #\u7981\u6b62\u5728header\u4e2d\u51fa\u73b0\u670d\u52a1\u5668\u7248\u672c\uff0c\u9632\u6b62\u9ed1\u5ba2\u5229\u7528\u7248\u672c\u6f0f\u6d1e\u653b\u51fb\n    server_tokens off;\n    #\u5982\u679c\u662f\u5168\u7ad9 HTTPS \u5e76\u4e14\u4e0d\u8003\u8651 HTTP \u7684\u8bdd\uff0c\u53ef\u4ee5\u52a0\u5165 HSTS \u544a\u8bc9\u4f60\u7684\u6d4f\u89c8\u5668\u672c\u7f51\u7ad9\u5168\u7ad9\u52a0\u5bc6\uff0c\u5e76\u4e14\u5f3a\u5236\u7528 HTTPS \u8bbf\u95ee\n    #add_header Strict-Transport-Security "max-age=31536000; includeSubdomains";\n    # ......\n    fastcgi_param   HTTPS               on;\n    fastcgi_param   HTTP_SCHEME         https;\n\n    access_log      /var/log/nginx/xxx.com.access.log;\n    error_log       /var/log/nginx/xxx.com.error.log;\n}\n')),(0,l.kt)("hr",null),(0,l.kt)("h4",{id:"\u91cd\u542f-nginx"},"\u91cd\u542f nginx"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl restart nginx\n")),(0,l.kt)("hr",null),(0,l.kt)("h4",{id:"\u91cd\u542f-certbot-\u81ea\u52a8\u66f4\u65b0"},"\u91cd\u542f certbot \u81ea\u52a8\u66f4\u65b0"),(0,l.kt)("p",null,"\u6a21\u62df\u66f4\u65b0"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"\nsudo certbot renew --dry-run\n# \u770b\u5230\u5982\u4e0b\u8f93\u51fa\u8bc1\u660e\u6a21\u62df\u66f4\u65b0\u6210\u529f\n-------------------------------------------------------------------------------\nProcessing /etc/letsencrypt/renewal/your.domain.com.conf\n-------------------------------------------------------------------------------\n** DRY RUN: simulating 'certbot renew' close to cert expiry\n**          (The test certificates below have not been saved.)\n\nCongratulations, all renewals succeeded. The following certs have been renewed:\n  /etc/letsencrypt/live/xxxx.com/fullchain.pem (success)\n** DRY RUN: simulating 'certbot renew' close to cert expiry\n**          (The test certificates above have not been saved.)\n")),(0,l.kt)("h4",{id:"\u5b9e\u73b0\u81ea\u52a8\u5316"},"\u5b9e\u73b0\u81ea\u52a8\u5316"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"sudo crontab -e\n\n#\u6dfb\u52a0\u914d\u7f6e\uff0c\u6bcf\u5468\u4e00\u534a\u591c3\u70b900\u5206\u6267\u884crenew\uff1a\n\n00 3 * * 1 /usr/bin/certbot renew  >> /var/log/le-renew.log\n")),(0,l.kt)("h2",{id:"acmesh"},"acme.sh"),(0,l.kt)("p",null,"\u5b89\u88c5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"curl  https://get.acme.sh | sh\n\nalias acme.sh=~/.acme.sh/acme.sh\n")),(0,l.kt)("p",null,"\u521b\u5efa\u8bc1\u4e66"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"acme.sh  --issue  -d xxx.com -d www.xxx.com  --webroot  /home/www/\n")),(0,l.kt)("p",null,"\u62f7\u8d1d\u8bc1\u4e66"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'acme.sh  --installcert  -d  xxx.com  \\\n        --key-file   /etc/nginx/ssl/xxx.com.key \\\n        --fullchain-file /etc/nginx/ssl/fullchain.cer \\\n        --reloadcmd  "service nginx force-reload"\n')),(0,l.kt)("p",null,"vi /etc/nginx/nginx.conf"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'    server {\n        listen       80;\n        server_name  lanten.me www.lanten.me;\n        return 301 https://$http_host$request_uri;\n    }\n    server {\n        listen       443 ssl http2 default_server;\n        listen       [::]:443 ssl http2 default_server;\n        server_name lanten.me www.lanten.me;\n\n        ssl_certificate "/etc/nginx/ssl/fullchain.cer";\n        ssl_certificate_key "/etc/nginx/ssl/lanten.me.key";\n\n        ssl_session_cache shared:SSL:1m;\n        ssl_session_timeout  10m;\n        ssl_ciphers HIGH:!aNULL:!MD5;\n        ssl_prefer_server_ciphers on;\n\n        root /home/www/;\n        try_files $uri /index.html;\n    }\n')),(0,l.kt)("h2",{id:"acmesh-\u4f1a\u5728\u8bc1\u4e66\u5230\u671f\u524d\u81ea\u52a8\u66f4\u65b0"},"acme.sh \u4f1a\u5728\u8bc1\u4e66\u5230\u671f\u524d\u81ea\u52a8\u66f4\u65b0"),(0,l.kt)("h2",{id:"\u53c2\u8003"},"\u53c2\u8003"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E"},"acme.sh wiki"))))}p.isMDXComponent=!0}}]);